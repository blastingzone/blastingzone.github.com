<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- jQuery -->
    <script src="./lib/jquery-1.11.3.min.js"></script>
    <!-- jQuery UI -->
    <script src="./lib/jquery-ui.js"></script>
    <!-- w3.css -->
    <link rel="stylesheet" href="./lib/w3.css">
    <link rel="stylesheet" id="theme_css" href="./lib/w3-theme-dark-grey.css">

    <title>Youtube Repeater</title>
    <style>
        .video_container {
            width: 36vw;
            height: 36vw;
        }

        .video_player {
            width: 100%;
            height: 100%;
        }

        .play_list_container {
            margin-top: 5vw;
            padding: 1vw;
        }

        .play_list_mov {
            width: 10vw;
            height: 10vw;
            display: inline-block;
            margin-right: -2vw;
            background-color: brown;
            -moz-transform: skewY(30deg);
            -ms-transform: skewY(30deg);
            -o-transform: skewY(30deg);
            -webkit-transform: skewY(30deg);
            transform: skewY(30deg);
            -moz-transition: transform ease-in 0.2s;
            -o-transition: transform ease-in 0.2s;
            -webkit-transition: transform ease-in 0.2s;
            transition: transform ease-in 0.2s;
        }

            .play_list_mov:hover {
                -moz-transform: skewY(10deg);
                -ms-transform: skewY(10deg);
                -o-transform: skewY(10deg);
                -webkit-transform: skewY(10deg);
                transform: skewY(10deg);
            }
        .play_list_mov img{
            width:100%;
            height:100%;
        }
    </style>
</head>
<body>
    <header class="w3-container w3-theme-d2">
        <h1>Y O U T U B E R E P E A T E R</h1>
    </header>
    <!-- Player -->
    <div class="w3-container">
        <div class="video_container w3-card-4 video_droppable">
            <div id="main_video_player" class="video_player"></div>
            <!--
            <iframe class="video_player" src="https://www.youtube.com/embed/4GZUQFcht78" frameborder="0" allowfullscreen></iframe>
                -->
        </div>
    </div>
    <!-- Mov List -->
    <div class="w3-container w3-card-4 play_list_container">
        <div class="play_list_mov" data-mov-id="4GZUQFcht78">
            <img src="http://img.youtube.com/vi/4GZUQFcht78/1.jpg"/>
        </div>
        <div class="play_list_mov" data-mov-id="sXD2eWLqzU0">
            <img src="http://img.youtube.com/vi/sXD2eWLqzU0/1.jpg" />
        </div>
        <div class="play_list_mov" data-mov-id="ci-L4ns4om8">
            <img src="http://img.youtube.com/vi/ci-L4ns4om8/1.jpg" />
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    // Ref :: https://developers.google.com/youtube/player_parameters?hl=ko

    function VideoController() {
        console.log("Create Video Controller");
    }
    VideoController.prototype.setPlayer = function (player) {
        this.player = player;
    }
    VideoController.prototype.getPlayer = function () {
        return this.player;
    }

    var g_videoController = new VideoController();

    // Main
    $(document).ready(function () {
        initialLoadYoutubeAPI();
        initialVideoListSortable();
        initialVideoListDraggable();
    });

    function getEmbedYoutubeUrl(url) {
        var embedKeyword = 'embed/';
        var originalKeyword = '/watch?v=';

        if (url.search(embedKeyword) !== -1) {
            // 1. embed url일 경우
            return url.slice(url.lastIndexOf(embedKeyword) + embedKeyword.length);
        } else {
            // 2. 생짜 url일 경우
            if (url.search('&list') !== -1) {
                // 2-1. 생짜 url인데 플레이리스트가 같이 있을 경우
                return url.slice(url.lastIndexOf('/watch?v=') + '/watch?v='.length).replace('&', '?');
            } else {
                // 2-2. 생짜 url이고 플레이리스트가 없는 경우
                return url.slice(url.lastIndexOf(originalKeyword) + originalKeyword.length);
            }

        }
    }

    function initialVideoListSortable() {
        $('.play_list_container').sortable();
        $('.play_list_container').disableSelection();
    }

    function initialVideoListDraggable() {
        $('.video_droppable').droppable({
            accept: ".play_list_mov",
            drop: function (event, ui) {
                console.debug(ui);
                var curVideoObject = ui.helper[0];
                // drop video object
                if ($(curVideoObject).hasClass('play_list_mov')) {
                    var video_url = $(curVideoObject).attr('data-mov-id');
                    var player = new YT.Player('main_video_player', {
                        videoId: video_url
                    });
                    console.log(video_url);
                    g_videoController.setPlayer(player);
                }
            }
        });
    }

    function initialLoadYoutubeAPI() {
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/player_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // YouTube player after the API code downloads.
        function onYouTubePlayerAPIReady() {

        }
    }

</script>