<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- jQuery -->
    <script src="./lib/jquery-1.11.3.min.js"></script>
    <!-- jQuery UI -->
    <script src="./lib/jquery-ui.js"></script>
    <!-- w3.css -->
    <link rel="stylesheet" href="./lib/w3.css">
    <link rel="stylesheet" id="theme_css" href="./lib/w3-theme-dark-grey.css">
    <!-- custom style sheet -->
    <link rel="stylesheet" media="all and (min-width : 960px)" href="./css/ytp/desktop.css" />
    <link rel="stylesheet" media="all and (min-width : 600px) and (max-width : 960px)" href="./css/ytp/tablet.css" />

    <title>Youtube Repeater</title>
    <style>
        
    </style>
</head>
<body>
    <header class="w3-container w3-theme-d2">
        <span class="w3-xxlarge">Y O U T U B E R E P E A T E R</span>
    </header>
    <!-- Player -->
    <div class="w3-container">
        <div class="video_container w3-card-4 video_droppable">
            <div id="main_video_player" class="video_player"></div>
            <!--
            <iframe class="video_player" src="https://www.youtube.com/embed/4GZUQFcht78" frameborder="0" allowfullscreen></iframe>
                -->
        </div>
    </div>
    <!-- Mov List -->
    <div class="w3-container w3-card-4 play_list_container">
        <div class="play_list_mov" data-mov-id="4GZUQFcht78">
            <img class="w3-circle" src="http://img.youtube.com/vi/4GZUQFcht78/1.jpg"/>
        </div>
        <div class="play_list_mov" data-mov-id="sXD2eWLqzU0">
            <img src="http://img.youtube.com/vi/sXD2eWLqzU0/1.jpg" />
        </div>
        <div class="play_list_mov" data-mov-id="ci-L4ns4om8">
            <img src="http://img.youtube.com/vi/ci-L4ns4om8/1.jpg" />
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    // Ref :: https://developers.google.com/youtube/player_parameters?hl=ko

    ////////////////////////////////////////////////////////////////
    // VIdeoController Class
    ////////////////////////////////////////////////////////////////
    function VideoController() {
        console.log("Create Video Controller");
    }
    VideoController.prototype.setPlayer = function (player) {
        this.player = player;
    }
    VideoController.prototype.getPlayer = function () {
        return this.player;
    }
    VideoController.prototype.destroyPlayer = function () {
        if (this.player !== undefined && this.player !== null) {
            this.player.destroy();
        } else {
            this.player = null;
        }
    }
    VideoController.prototype.playVideo = function() {
        if (this.player !== undefined && this.player !== null) {
            this.player.playVideo();
        }
    }
    VideoController.prototype.stopVideo = function () {
        if (this.player !== undefined && this.player !== null) {
            this.player.stopVideo();
        }
    }
    VideoController.prototype.pauseVideo = function () {
        if (this.player !== undefined && this.player !== null) {
            this.player.pauseVideo();
        }
    }
    ////////////////////////////////////////////////////////////////

    var g_videoController = new VideoController();

    // Main
    $(document).ready(function () {
        initialLoadYoutubeAPI();
        initialVideoListSortable();
        initialVideoListDraggable();
    });

    function getEmbedYoutubeUrl(url) {
        var embedKeyword = 'embed/';
        var originalKeyword = '/watch?v=';

        if (url.search(embedKeyword) !== -1) {
            // 1. embed url일 경우
            return url.slice(url.lastIndexOf(embedKeyword) + embedKeyword.length);
        } else {
            // 2. 생짜 url일 경우
            if (url.search('&list') !== -1) {
                // 2-1. 생짜 url인데 플레이리스트가 같이 있을 경우
                return url.slice(url.lastIndexOf('/watch?v=') + '/watch?v='.length).replace('&', '?');
            } else {
                // 2-2. 생짜 url이고 플레이리스트가 없는 경우
                return url.slice(url.lastIndexOf(originalKeyword) + originalKeyword.length);
            }

        }
    }

    function initialVideoListSortable() {
        $('.play_list_container').sortable();
        $('.play_list_container').disableSelection();
    }

    function initialVideoListDraggable() {
        $('.video_droppable').droppable({
            accept: ".play_list_mov",
            drop: function (event, ui) {
                console.debug(ui);
                var curVideoObject = ui.helper[0];
                // drop video object
                if ($(curVideoObject).hasClass('play_list_mov')) {
                    g_videoController.destroyPlayer();
                    var video_url = $(curVideoObject).attr('data-mov-id');
                    var player = new YT.Player('main_video_player', {
                        videoId: video_url
                    });
                    console.log(video_url);
                    g_videoController.setPlayer(player);
                }
            }
        });
    }

    function initialLoadYoutubeAPI() {
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/player_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // YouTube player after the API code downloads.
        function onYouTubePlayerAPIReady() {

        }
    }


</script>